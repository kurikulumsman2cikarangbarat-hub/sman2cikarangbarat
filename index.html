<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Hasil TKA SMAN 2 Cikarang Barat</title>
    <style>
        /* CSS SAMA SEPERTI SEBELUMNYA */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #f5f7fa; color: #333; line-height: 1.6; padding: 20px; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .login-container { max-width: 500px; width: 100%; background-color: white; border-radius: 10px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1); padding: 40px; }
        .letterhead { text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 3px double #3498db; }
        .letterhead h2 { color: #2c3e50; font-size: 20px; margin-bottom: 5px; text-transform: uppercase; }
        .letterhead h3 { color: #2c3e50; font-size: 16px; margin-bottom: 5px; }
        .letterhead h4 { color: #2c3e50; font-size: 14px; font-weight: normal; margin-bottom: 3px; }
        .login-form { margin-top: 30px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: bold; color: #2c3e50; margin-bottom: 8px; }
        .form-group input { width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; transition: border-color 0.3s; }
        .form-group input:focus { outline: none; border-color: #3498db; box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2); }
        .info-text { font-size: 14px; color: #7f8c8d; margin-top: 5px; text-align: center; }
        .btn { width: 100%; padding: 14px; background-color: #3498db; color: white; border: none; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background-color 0.3s; margin-top: 10px; }
        .btn:hover { background-color: #2980b9; }
        .btn:disabled { background-color: #95a5a6; cursor: not-allowed; }
        .error-message { color: #e74c3c; font-size: 14px; margin-top: 15px; text-align: center; display: none; padding: 10px; background: #fce4e4; border-radius: 5px; }
        
        /* Result Styles */
        .result-container { max-width: 1000px; width: 100%; background-color: white; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08); padding: 30px; display: none; }
        .info-section { margin-bottom: 25px; }
        .info-row { display: flex; margin-bottom: 8px; align-items: flex-start; }
        .info-label { font-weight: bold; color: #2c3e50; min-width: 320px; flex-shrink: 0; }
        .colon { margin-right: 10px; }
        .info-value { color: #34495e; flex-grow: 1; }
        .text-content { margin: 25px 0; padding: 15px; background-color: #f8f9fa; border-radius: 6px; border-left: 4px solid #3498db; line-height: 1.7; }
        .result-title { text-align: center; font-weight: bold; font-size: 18px; margin: 25px 0 15px 0; color: #2c3e50; padding-bottom: 10px; border-bottom: 1px solid #ddd; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); }
        caption { font-weight: bold; text-align: left; margin-bottom: 10px; color: #2c3e50; font-size: 16px; }
        th { background-color: #3498db; color: white; font-weight: 600; text-align: center; padding: 12px 8px; border: 1px solid #ddd; }
        td { padding: 10px 8px; border: 1px solid #e1e1e1; }
        td:nth-child(2) { text-align: left; padding-left: 15px; }
        td:nth-child(3), td:nth-child(4) { text-align: center; }
        tr:nth-child(even) { background-color: #f8f9fa; }
        .subject-choice { margin-top: 30px; }
        .footer-note { margin-top: 30px; font-style: italic; color: #7f8c8d; text-align: center; padding-top: 15px; border-top: 1px dashed #ddd; }
        .logout-btn { background-color: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 20px; display: block; margin-left: auto; }
        .logout-btn:hover { background-color: #c0392b; }
        
        /* Loading Spinner */
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; margin-left: 10px; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        @media print {
            body { background-color: white; padding: 10px; }
            .login-container, .logout-btn { display: none; }
            .result-container { box-shadow: none; padding: 15px; display: block !important; }
        }
        @media (max-width: 768px) {
            .login-container, .result-container { padding: 20px; }
            .info-row { flex-direction: column; }
            .info-label { min-width: 100%; margin-bottom: 5px; }
            .colon { display: none; }
            table { font-size: 14px; }
            th, td { padding: 8px 5px; }
        }
    </style>
</head>
<body>
    <div class="login-container" id="loginContainer">
        <div class="letterhead">
            <h2>SMAN 2 CIKARANG BARAT</h2>
            <h3>KCD WIL III DINAS PENDIDIKAN PROVINSI JAWA BARAT</h3>
            <h4>Perum Metland Cibitung, Cikarang Barat, Bekasi</h4>
            <h4>sman2cikarangbarat.pages.dev | Email: sman2cikarangbarat@gmail.com</h4>
        </div>
        
        <div class="result-title">LOGIN HASIL TKA</div>
        
        <form class="login-form" id="loginForm">
            <div class="form-group">
                <label for="nisn">Nomor Induk Siswa Nasional (NISN)</label>
                <input type="text" id="nisn" name="nisn" maxlength="10" placeholder="Masukkan 10 digit NISN" required>
            </div>
            
            <div class="form-group">
                <label for="birthdate">Tanggal Lahir (DD-MM-YYYY)</label>
                <input type="text" id="birthdate" name="birthdate" placeholder="Contoh: 31-12-2008" required>
            </div>
            
            <div class="error-message" id="errorMessage"></div>
            
            <button type="submit" class="btn" id="submitBtn">
                Lihat Hasil <div class="loader" id="loader"></div>
            </button>
        </form>
    </div>
    
    <div class="result-container" id="resultContainer">
        <div class="letterhead">
            <h2>SMAN 2 CIKARANG BARAT</h2>
            <h3>KCD WIL III DINAS PENDIDIKAN PROVINSI JAWA BARAT</h3>
            <h4>Perum Metland Cibitung, Cikarang Barat, Bekasi</h4>
            <h4>sman2cikarangbarat.pages.dev | Email: sman2cikarangbarat@gmail.com</h4>
        </div>
        
        <div class="result-title">HASIL TES KOMPETENSI AKADEMIK (TKA)</div>
        
        <div class="info-section">
            <div class="info-row">
                <div class="info-label">Nama</div><div class="colon">:</div>
                <div class="info-value" id="resNama">-</div> </div>
            <div class="info-row">
                <div class="info-label">Tempat, Tanggal Lahir</div><div class="colon">:</div>
                <div class="info-value" id="resTtl">-</div> </div>
            <div class="info-row">
                <div class="info-label">Nomor Induk Siswa Nasional</div><div class="colon">:</div>
                <div class="info-value" id="resNisn">-</div> </div>
            <div class="info-row">
                <div class="info-label">Nomor Peserta TKA</div><div class="colon">:</div>
                <div class="info-value" id="resNoUjian">-</div> </div>
            <div class="info-row">
                <div class="info-label">NPSN - Satuan Pendidikan Asal</div><div class="colon">:</div>
                <div class="info-value">69964653</div>
            </div>
            <div class="info-row">
                <div class="info-label">NPSN - Satuan Pendidikan Pelaksana</div><div class="colon">:</div>
                <div class="info-value">69964653</div>
            </div>
            <div class="info-row">
                <div class="info-label">Tanggal Pelaksanaan TKA</div><div class="colon">:</div>
                <div class="info-value">3 - 6 November 2025</div>
            </div>
        </div>
        
        <div class="text-content">
            <p>Yang telah mengikuti TKA di Kabupaten Bekasi, Provinsi Jawa Barat sesuai Pedoman Penyelenggaraan, Nomor 9 yang diterbitkan tahun 2025 dengan hasil:</p>
        </div>
        
        <table>
            <caption>Hasil Tes Kompetensi Akademik</caption>
            <thead>
                <tr>
                    <th width="10%">No</th>
                    <th width="50%">Mata Pelajaran</th>
                    <th width="20%">Nilai</th>
                    <th width="20%">Kategori</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>Bahasa Indonesia</td>
                    <td id="val_bin">-</td> <td id="kat_bin">-</td> </tr>
                <tr>
                    <td>2</td>
                    <td>Matematika</td>
                    <td id="val_mtk">-</td> <td id="kat_mtk">-</td> </tr>
                <tr>
                    <td>3</td>
                    <td>Bahasa Inggris</td>
                    <td id="val_big">-</td> <td id="kat_big">-</td> </tr>
            </tbody>
        </table>
        
        <div class="subject-choice">
            <table>
                <caption>Mata Pelajaran Pilihan</caption>
                <thead>
                    <tr>
                        <th width="10%">No</th>
                        <th width="50%">Mata Pelajaran</th>
                        <th width="20%">Nilai</th>
                        <th width="20%">Kategori</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>4</td>
                        <td id="name_mp1">Pilihan 1</td> <td id="val_mp1">-</td> <td id="kat_mp1">-</td> </tr>
                    <tr>
                        <td>5</td>
                        <td id="name_mp2">Pilihan 2</td> <td id="val_mp2">-</td> <td id="kat_mp2">-</td> </tr>
                </tbody>
            </table>
        </div>
        
        <div class="footer-note">
            <p>* Dokumen ini merupakan hasil dari Tes Kompetensi Akademik (TKA) yang dilakukan sesuai dengan pedoman penyelenggaraan yang berlaku.</p>
        </div>
        
        <button class="logout-btn" id="logoutBtn">Keluar</button>
    </div>
    
    <script>
        // KONFIGURASI PENTING
        // GANTI URL DI BAWAH INI DENGAN URL WEB APP DARI GOOGLE APPS SCRIPT ANDA
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzmpNkRZt61bTrM-Dmk9NAyIUP5ibRblkLig-r1VbLbTCt9IY-t6XY5SLZuCeIW7vFadg/exec'; 

        document.addEventListener('DOMContentLoaded', function() {
            const loginForm = document.getElementById('loginForm');
            const loginContainer = document.getElementById('loginContainer');
            const resultContainer = document.getElementById('resultContainer');
            const errorMessage = document.getElementById('errorMessage');
            const logoutBtn = document.getElementById('logoutBtn');
            const submitBtn = document.getElementById('submitBtn');
            const loader = document.getElementById('loader');
            
            // Format input visual
            const nisnInput = document.getElementById('nisn');
            const birthdateInput = document.getElementById('birthdate');

            nisnInput.addEventListener('input', function() {
                this.value = this.value.replace(/\D/g, '').slice(0, 10);
            });
            
            birthdateInput.addEventListener('input', function(e) {
                let value = this.value.replace(/\D/g, '');
                if (value.length >= 2 && value.length < 4) value = value.slice(0, 2) + '-' + value.slice(2);
                else if (value.length >= 4 && value.length < 8) value = value.slice(0, 2) + '-' + value.slice(2, 4) + '-' + value.slice(4);
                else if (value.length >= 8) value = value.slice(0, 2) + '-' + value.slice(2, 4) + '-' + value.slice(4, 8);
                this.value = value;
            });

            // Handle Submit hanya dengan NISN
loginForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const nisn = nisnInput.value.trim();
    // Tanggal lahir diabaikan atau diisi string kosong
    const birthdate = ""; 

    if (nisn.length < 3) {
        showError("Mohon masukkan NISN dengan benar.");
        return;
    }

    // UI Loading State
    setLoading(true);

    // Kirim data ke Apps Script (Hanya mengirim NISN, tgl dikirim kosong)
    fetch(SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify({ nisn: nisn, tgl: birthdate }) 
    })
    .then(response => response.json())
    .then(response => {
        setLoading(false);
        if (response.status === 'success') {
            populateData(response.data);
            showResult();
        } else {
            // Pesan error diubah agar tidak menyebutkan tanggal lahir
            showError("Data tidak ditemukan! Periksa kembali NISN Anda.");
        }
    })
    .catch(error => {
        setLoading(false);
        console.error('Error:', error);
        showError("Terjadi kesalahan koneksi. Silakan coba lagi.");
    });
});
            function populateData(data) {
                // Isi Identitas
                document.getElementById('resNama').textContent = data.nama;
                document.getElementById('resTtl').textContent = data.ttl; // Menampilkan data dari Kolom C
                document.getElementById('resNisn').textContent = data.nisn; // Kolom L
                document.getElementById('resNoUjian').textContent = data.no_ujian;

                // Isi Nilai Wajib
                document.getElementById('val_bin').textContent = data.n_bin;
                document.getElementById('kat_bin').textContent = data.k_bin;
                
                document.getElementById('val_mtk').textContent = data.n_mtk;
                document.getElementById('kat_mtk').textContent = data.k_mtk;
                
                document.getElementById('val_big').textContent = data.n_big;
                document.getElementById('kat_big').textContent = data.k_big;

                // Isi Nilai Pilihan (Nama Mapel Dinamis)
                document.getElementById('name_mp1').textContent = data.mp1;
                document.getElementById('val_mp1').textContent = data.n_mp1;
                document.getElementById('kat_mp1').textContent = data.k_mp1;
                
                document.getElementById('name_mp2').textContent = data.mp2;
                document.getElementById('val_mp2').textContent = data.n_mp2;
                document.getElementById('kat_mp2').textContent = data.k_mp2;
            }

            function setLoading(isLoading) {
                if(isLoading) {
                    submitBtn.disabled = true;
                    submitBtn.childNodes[0].nodeValue = "Memuat... "; // Change text
                    loader.style.display = 'inline-block';
                    errorMessage.style.display = 'none';
                } else {
                    submitBtn.disabled = false;
                    submitBtn.childNodes[0].nodeValue = "Lihat Hasil ";
                    loader.style.display = 'none';
                }
            }

            function showError(msg) {
                errorMessage.textContent = msg;
                errorMessage.style.display = 'block';
            }

            function showResult() {
                loginContainer.style.display = 'none';
                resultContainer.style.display = 'block';
                window.scrollTo(0,0);
            }

            logoutBtn.addEventListener('click', function() {
                loginContainer.style.display = 'block';
                resultContainer.style.display = 'none';
                loginForm.reset();
                errorMessage.style.display = 'none';
            });
        });
    </script>
</body>
</html>
