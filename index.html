<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Login - Hasil TKA SMAN 2 Cikarang Barat</title>
    <style>
        /* CSS */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { 
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            padding: 20px; 
            display: flex; 
            justify-content: center; 
            align-items: center;
            min-height: 100vh;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* Blokir inspect element dan klik kanan */
        body {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* Login Container */
        .container { 
            background: white; 
            max-width: 500px; 
            width: 100%; 
            padding: 40px; 
            border-radius: 12px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
            height: fit-content; 
            transition: transform 0.3s ease;
        }
        .container:hover {
            transform: translateY(-5px);
        }
        
        /* Header Styling */
        .header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #007bff;
        }
        .logo-container {
            flex-shrink: 0;
        }
        .school-logo {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            border: 2px solid #1e3c72;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .header-text {
            flex: 1;
        }
        .header h2 { 
            color: #1e3c72; 
            margin-bottom: 5px;
            font-size: 24px;
        }
        .header h4 { 
            color: #2a5298;
            font-weight: 600;
            font-size: 16px;
        }
        
        /* Form Styling */
        .form-group { 
            margin-bottom: 20px; 
        }
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        input { 
            width: 100%; 
            padding: 12px 15px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            font-size: 16px; 
            transition: border-color 0.3s;
        }
        input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.1);
        }
        
        /* Button Styling */
        .btn { 
            width: 100%; 
            padding: 14px; 
            background: linear-gradient(to right, #007bff, #0056b3); 
            color: white; 
            border: none; 
            border-radius: 4px; 
            font-size: 16px; 
            font-weight: 600;
            cursor: pointer; 
            margin-top: 10px; 
            transition: all 0.3s;
        }
        .btn:hover { 
            background: linear-gradient(to right, #0056b3, #004494);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,86,179,0.3);
        }
        
        /* Error Message */
        .error { 
            color: #721c24; 
            text-align: center; 
            margin-top: 15px; 
            font-size: 14px; 
            background: #f8d7da; 
            padding: 12px; 
            border-radius: 4px; 
            border: 1px solid #f5c6cb;
            display: none; 
        }
        
        /* Result Container */
        #resultContainer { 
            display: none; 
            max-width: 900px; 
            padding: 40px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        /* Kop Surat Styling */
        .kop-surat {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #1e3c72;
        }
        .kop-surat h1 {
            color: #1e3c72;
            font-size: 22px;
            margin-bottom: 3px;
            font-weight: 700;
        }
        .kop-surat h2 {
            color: #2a5298;
            font-size: 16px;
            margin-bottom: 2px;
            font-weight: 600;
        }
        .kop-surat .address {
            color: #333;
            font-size: 13px;
            margin-bottom: 5px;
        }
        .kop-surat .contact {
            color: #666;
            font-size: 12px;
            margin-top: 8px;
        }
        
        /* Judul Hasil TKA */
        .judul-tka {
            text-align: center;
            margin: 25px 0 30px 0;
            color: #1e3c72;
            font-size: 20px;
            font-weight: 700;
            padding-bottom: 15px;
            border-bottom: 2px solid #1e3c72;
        }
        
        /* Container Data Siswa */
        .data-container {
            margin: 30px 0;
        }
        
        /* Data Item Styling - Mengikuti format tabel dari gambar */
        .data-item {
            display: flex;
            margin-bottom: 10px;
            align-items: flex-start;
        }
        .data-label {
            width: 320px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
            text-align: left;
        }
        .data-separator {
            width: 20px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
            text-align: center;
        }
        .data-value {
            flex: 1;
            color: #000;
            font-weight: 500;
            font-size: 14px;
        }
        
        /* Penjelasan TKA - ukuran font lebih besar */
        .penjelasan {
            font-size: 14px;
            color: #555;
            margin: 30px 0;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 6px;
            font-style: italic;
            text-align: justify;
            line-height: 1.6;
        }
        
        /* Table Styling */
        .table-container {
            margin: 30px 0;
        }
        .table-title {
            background: #1e3c72;
            color: white;
            padding: 12px;
            font-weight: 600;
            text-align: center;
            border-radius: 6px 6px 0 0;
            font-size: 16px;
            margin-bottom: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            border: 1px solid #ddd;
        }
        th {
            background: #2a5298;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: 600;
            border: 1px solid #ddd;
            font-size: 14px;
        }
        td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
            font-size: 14px;
            color: #000;
        }
        td:first-child {
            text-align: center;
            width: 60px;
            font-weight: 500;
        }
        td:nth-child(2) {
            font-weight: 500;
        }
        td:nth-child(3), td:nth-child(4) {
            text-align: center;
            width: 120px;
            font-weight: 500;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        /* Catatan Kaki - dipindah di atas tombol */
        .catatan-container {
            margin: 20px 0 30px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 6px;
            border: 1px solid #eee;
        }
        .catatan {
            font-size: 12px;
            color: #666;
            font-style: italic;
            text-align: justify;
            line-height: 1.5;
            margin: 0;
        }
        
        /* Logout Button - ukuran lebih kecil */
        .logout-container {
            margin-bottom: 20px;
        }
        .logout { 
            background: linear-gradient(to right, #dc3545, #c82333); 
            width: 100%;
            padding: 10px;
            font-size: 14px;
        }
        .logout:hover { 
            background: linear-gradient(to right, #c82333, #a71d2a);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220,53,69,0.3);
        }
        
        /* Kurikulum Footnote */
        .kurikulum-container {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px dashed #ccc;
        }
        .kurikulum {
            font-size: 11px;
            color: #888;
            text-align: center;
            font-style: italic;
        }
        
        /* Footer di menu login */
        .login-footer {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            text-align: center;
        }
        .login-kurikulum {
            font-size: 11px;
            color: #888;
            font-style: italic;
        }
    </style>
</head>
<body oncontextmenu="return false" onkeydown="if(event.keyCode==123){return false;}">

    <div class="container" id="loginContainer">
        <div class="header">
            <div class="logo-container">
                <img src="logo.jpg" 
                     alt="Logo SMAN 2 Cikarang Barat" 
                     class="school-logo"
                     onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjgwIiByeD0iOCIgZmlsbD0iIzFlM2M3MiIvPgo8dGV4dCB4PSI0MCIgeT0iNDUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMiIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkxPR088L3RleHQ+Cjwvc3ZnPgo=';">
            </div>
            <div class="header-text">
                <h2>LOGIN HASIL TKA</h2>
                <h4>SMAN 2 CIKARANG BARAT</h4>
            </div>
        </div>
        
        <form id="loginForm">
            <div class="form-group">
                <label>NISN</label>
                <input type="tel" id="nisn" maxlength="20" placeholder="Masukkan NISN..." required>
            </div>
            
            <div class="form-group">
                <label>Tanggal Lahir (DD/MM/YYYY)</label>
                <input type="text" id="birthdate" placeholder="Contoh: 27/04/2008" required>
                <small style="color:#666; display:block; margin-top:5px;">Gunakan format: DD/MM/YYYY</small>
            </div>
            
            <button type="submit" class="btn" id="submitBtn">LIHAT HASIL</button>
        </form>
        <div class="error" id="errorMessage"></div>
        
        <!-- Footer di menu login -->
        <div class="login-footer">
            <div class="login-kurikulum">
                Kurikulum SMAN 2 Cikarang Barat
            </div>
        </div>
    </div>

    <div class="container" id="resultContainer">
        <!-- Kop Surat -->
        <div class="kop-surat">
            <h1>SMAN 2 CIKARANG BARAT</h1>
            <h2>KCD WIL III DINAS PENDIDIKAN PROVINSI JAWA BARAT</h2>
            <div class="address">Perum Metland Cibitung, Cikarang Barat, Bekasi</div>
            <div class="contact">sman2cikarangbarat.pages.dev | Email: sman2cikarangbarat@gmail.com</div>
        </div>

        <!-- Judul Hasil TKA -->
        <div class="judul-tka">HASIL TES KOMPETENSI AKADEMIK (TKA)</div>

        <!-- Data Siswa -->
        <div class="data-container" id="studentInfo">
            <!-- Data akan diisi oleh JavaScript -->
        </div>

        <!-- Penjelasan TKA - Font size sama dengan teks lainnya -->
        <div class="penjelasan">
            Yang telah mengikuti TKA di Kabupaten Bekasi, Provinsi Jawa Barat sesuai Pedoman Penyelenggaraan, Nomor 9 yang diterbitkan tahun 2025 dengan hasil:
        </div>

        <!-- Tabel Hasil TKA -->
        <div class="table-container">
            <div class="table-title">Hasil Tes Kompetensi Akademik</div>
            <table id="scoreTableMain">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Mata Pelajaran</th>
                        <th>Nilai</th>
                        <th>Kategori</th>
                    </tr>
                </thead>
                <tbody id="scoreTableMainBody">
                    <!-- Data akan diisi oleh JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Tabel Mata Pelajaran Pilihan -->
        <div class="table-container">
            <div class="table-title">Mata Pelajaran Pilihan</div>
            <table id="scoreTablePilihan">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Mata Pelajaran</th>
                        <th>Nilai</th>
                        <th>Kategori</th>
                    </tr>
                </thead>
                <tbody id="scoreTablePilihanBody">
                    <!-- Data akan diisi oleh JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Catatan Kaki di bawah tabel -->
        <div class="catatan-container">
            <div class="catatan">
                * Dokumen ini merupakan hasil dari Tes Kompetensi Akademik (TKA) yang dilakukan sesuai dengan pedoman penyelenggaraan yang berlaku.
            </div>
        </div>

        <!-- Logout Button - ukuran lebih kecil dan hanya "Keluar" -->
        <div class="logout-container">
            <button class="btn logout" onclick="location.reload()">KELUAR</button>
        </div>

        <!-- Kurikulum Footnote di bawah tombol -->
        <div class="kurikulum-container">
            <div class="kurikulum">
                Kurikulum SMAN 2 Cikarang Barat
            </div>
        </div>
    </div>

<script>
        // Blokir F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12' || 
                (e.ctrlKey && e.shiftKey && e.key === 'I') || 
                (e.ctrlKey && e.shiftKey && e.key === 'J') || 
                (e.ctrlKey && e.key === 'U') ||
                (e.ctrlKey && e.shiftKey && e.key === 'C')) {
                e.preventDefault();
                return false;
            }
        });
        
        // Blokir klik kanan
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });
        
        // Blokir drag and drop
        document.addEventListener('dragstart', function(e) {
            e.preventDefault();
            return false;
        });
        
        // Blokir seleksi teks
        document.addEventListener('selectstart', function(e) {
            e.preventDefault();
            return false;
        });

        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw8CBBQA_pdm_7AihngbfQ_swaSWAm6oAz4KptsRvQtxsZciWLDmypOJCIlgbStwj2A/exec";

        // Format tanggal otomatis
        document.getElementById('birthdate').addEventListener('input', function(e) {
            let v = this.value.replace(/\D/g, '');
            if (v.length >= 2) v = v.slice(0, 2) + '/' + v.slice(2);
            if (v.length >= 5) v = v.slice(0, 5) + '/' + v.slice(5, 9);
            this.value = v;
        });

        // Handle form submission
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const btn = document.getElementById('submitBtn');
            const err = document.getElementById('errorMessage');
            const nisn = document.getElementById('nisn').value.trim();
            const birthdate = document.getElementById('birthdate').value.trim();

            btn.disabled = true;
            btn.textContent = "Mencari Data...";
            err.style.display = 'none';

            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ nisn: nisn, birthdate: birthdate })
            })
            .then(res => res.json())
            .then(response => {
                if (response.status === 'success') {
                    showResult(response.data);
                } else {
                    // Pesan error yang aman tanpa mengekspos detail database
                    if (response.message && response.message.includes("NISN Ketemu")) {
                        err.textContent = "Data tidak ditemukan. NISN ditemukan, tapi Tanggal tidak sesuai";
                    } else if (response.message && response.message.includes("NISN tidak ditemukan")) {
                        err.textContent = "Data tidak ditemukan. Silakan periksa kembali NISN dan Tanggal Lahir";
                    } else if (response.message && response.message.includes("Tidak ada data")) {
                        err.textContent = "Data tidak ditemukan";
                    } else {
                        // Pesan umum untuk error lainnya
                        err.textContent = "Data tidak ditemukan. Silakan periksa kembali NISN dan Tanggal Lahir";
                    }
                    err.style.display = 'block';
                }
                btn.disabled = false;
                btn.textContent = "LIHAT HASIL";
            })
            .catch(error => {
                err.textContent = "Terjadi kesalahan koneksi. Silakan coba lagi.";
                err.style.display = 'block';
                btn.disabled = false;
                btn.textContent = "LIHAT HASIL";
            });
        });

        function showResult(data) {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('resultContainer').style.display = 'block';

            // Format nomor peserta sesuai contoh dari gambar
            const nomorPeserta = `T3-25-02-12-1005-${data.no_ujian} ${data.nisn}`;

            // Data Siswa dalam format tabel seperti gambar
            document.getElementById('studentInfo').innerHTML = `
                <div class="data-item">
                    <div class="data-label">Nama</div>
                    <div class="data-separator">:</div>
                    <div class="data-value">${data.nama}</div>
                </div>
                <div class="data-item">
                    <div class="data-label">Tempat, Tanggal Lahir</div>
                    <div class="data-separator">:</div>
                    <div class="data-value">${data.ttl}</div>
                </div>
                <div class="data-item">
                    <div class="data-label">Nomor Induk Siswa Nasional</div>
                    <div class="data-separator">:</div>
                    <div class="data-value">${data.nisn}</div>
                </div>
                <div class="data-item">
                    <div class="data-label">Nomor Peserta TKA</div>
                    <div class="data-separator">:</div>
                    <div class="data-value">${nomorPeserta}</div>
                </div>
                <div class="data-item">
                    <div class="data-label">NPSN - Satuan Pendidikan Asal</div>
                    <div class="data-separator">:</div>
                    <div class="data-value">69964653</div>
                </div>
                <div class="data-item">
                    <div class="data-label">NPSN - Satuan Pendidikan Pelaksana</div>
                    <div class="data-separator">:</div>
                    <div class="data-value">69964653</div>
                </div>
                <div class="data-item">
                    <div class="data-label">Tanggal Pelaksanaan TKA</div>
                    <div class="data-separator">:</div>
                    <div class="data-value">3 - 6 November 2025</div>
                </div>
            `;

            // Tabel Hasil TKA Utama - format nilai dengan koma
            document.getElementById('scoreTableMainBody').innerHTML = `
                <tr>
                    <td>1</td>
                    <td>Bahasa Indonesia</td>
                    <td>${formatNilai(data.n_bin)}</td>
                    <td>${data.k_bin}</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Matematika</td>
                    <td>${formatNilai(data.n_mtk)}</td>
                    <td>${data.k_mtk}</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>Bahasa Inggris</td>
                    <td>${formatNilai(data.n_big)}</td>
                    <td>${data.k_big}</td>
                </tr>
            `;

            // Tabel Mata Pelajaran Pilihan - format nilai dengan koma
            document.getElementById('scoreTablePilihanBody').innerHTML = `
                <tr>
                    <td>4</td>
                    <td>${data.mp1}</td>
                    <td>${formatNilai(data.n_mp1)}</td>
                    <td>${data.k_mp1}</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>${data.mp2}</td>
                    <td>${formatNilai(data.n_mp2)}</td>
                    <td>${data.k_mp2}</td>
                </tr>
            `;
        }

        // Fungsi untuk format nilai dengan koma
        function formatNilai(nilai) {
            // Ganti titik dengan koma
            return nilai.toString().replace('.', ',');
        }
    </script>

</body>
</html>
