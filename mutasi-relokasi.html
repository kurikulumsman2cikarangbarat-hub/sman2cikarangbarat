<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzthUfoVELG3z_VTY1ClyxKnSV76BN9FtGha6sSyMOnKHQ93qPV0gFMhQ3Qtz_G0U2u/exec';
    const form = document.getElementById('mutasiForm');

    form.addEventListener('submit', e => {
        e.preventDefault();
        const btn = document.getElementById('btnSubmit');
        const status = document.getElementById('status');
        
        btn.disabled = true;
        btn.innerText = 'Sedang Mengirim...';

        const formData = new FormData(form);
        
        // Mengubah data ke format URLSearchParams agar kompatibel penuh dengan Mobile
        const params = new URLSearchParams();
        formData.forEach((value, key) => {
            params.append(key, value);
        });

        fetch(scriptURL, {
            method: 'POST',
            mode: 'no-cors', // Menghindari isu CORS di mobile
            body: params // Mengirim format key=value&key=value
        })
        .then(() => {
            // Logika WhatsApp
            const data = Object.fromEntries(formData.entries());
            const noTujuan = "6285899888006";
            const pesan = `Assalamu 'alaykum Warahmatullah, Perkenalkan Saya ${data.nama} (${data.nip}), guru mata pelajaran ${data.mapel}, bermaksud mengajukan mutasi/relokasi ke SMAN 2 Cikarang Barat, saat ini Saya ${data.sertifikat.toLowerCase()} memiliki Sertifikat Guru Profesional.`;
            const waLink = `https://wa.me/${noTujuan}?text=${encodeURIComponent(pesan)}`;

            status.innerHTML = "✅ Data Berhasil Disimpan!";
            status.style.color = "green";

            setTimeout(() => {
                window.location.href = waLink;
            }, 1000);
        })
        .catch(error => {
            status.innerHTML = "❌ Terjadi kesalahan. Coba lagi.";
            status.style.color = "red";
            btn.disabled = false;
        });
    });
</script>
